<!DOCTYPE html>
<html >
   <head>
      <meta charset="UTF-8">
      <title>Customer Details Entry Form</title>
      <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css'>
      <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css'>
      <link rel='stylesheet prefetch' href='http://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.0/css/bootstrapValidator.min.css'>
      <script type="text/javascript" src="vendor/jquery/jquery.min.js"></script>
      <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="dist/js/bootstrapValidator.js"></script>
      <script type="text/javascript" src="lib/jquery-ui.js"></script>
      <script src="lib/bootstrap/js/bootstrap-datepicker.js"></script>
      <link rel="stylesheet" type="text/css" href="lib/jquery-ui.css">
      <link rel="stylesheet" href="css/style.css">
   </head>
   <body>
      <div class="container">
         <form class="well form-horizontal" action=" " method="post"  id="new_account_details" data-toggle="validator">
            <fieldset>
               <!-- Form Name -->
               <legend>New Account Details</legend>
               <div class="form-group">
                  <label class="col-md-4 control-label">E-Mail</label>  
                  <div class="col-md-4 inputGroupContainer">
                     <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                        <input name="email" placeholder="E-Mail Address of existing customer" class="form-control"  type="text">
                     </div>
                  </div>
               </div>
               <div class="form-group">
                  <label class="col-md-4 control-label">Account Type</label>
                  <div class="col-md-4 selectContainer">
                     <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
                        <select name="accountType" class="form-control selectpicker" >
                           <option value=" " >Select Account Type</option>
                           <option>SAVINGS</option>
                           <option>CURRENT</option>
                        </select>
                     </div>
                  </div>
               </div>
               <!-- Text input-->
               <div class="form-group">
                  <label class="col-md-4 control-label">Initial Deposit</label>  
                  <div class="col-md-4 inputGroupContainer">
                     <div class="input-group">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-usd"></i></span>
                        <span class="input-group-addon"><input type="button" value="USD" disabled/></span>
                        <input name="initialDeposit" placeholder="0.00" class="form-control" type="text">
                     </div>
                  </div>
               </div>
               <!-- Success message -->
               <div class="alert alert-success" role="alert" id="success_message">Success <i class="glyphicon glyphicon-thumbs-up"></i> New account has been added as per the details given</div>
               <div class="alert alert-danger" role="alert" id="failure_message">Failure <i class="glyphicon glyphicon-thumbs-down"></i> Adding the account failed, check the customer email ID provided, it has to be an email Id of an existing customer. You can add a new customer <a href="addCustomer.html">here</a></div>
               <div class="alert alert-info" role="alert" id="message"></div>
               <!-- Button -->
               <div class="form-group">
                  <label class="col-md-4 control-label"></label>
                  <div class="col-md-4">
                     <button type="submit" class="btn btn-warning" id="submit1">Send <span class="glyphicon glyphicon-send"></span></button>
                  </div>
               </div>
               <div class="form-group">
                  <label class="col-md-4 control-label"></label>
                  <div class="col-md-4">
                     <button type="button" class="btn btn-info" id="resetBtn">Reset form</button>
                  </div>
               </div>
            </fieldset>
         </form>
      </div>
      </div>
      <footer>
         <a href="index.html">
            <h4>Home</h4>
         </a>
      </footer>
      <script type="text/javascript">
         $(document).ready(function() {
          $('#new_account_details')
          .bootstrapValidator({
            message: 'This value is not valid',
                              //live: 'submitted',
                              feedbackIcons: {
                                valid: 'glyphicon glyphicon-ok',
                                invalid: 'glyphicon glyphicon-remove',
                                validating: 'glyphicon glyphicon-refresh'
                              },
                              fields: {
                                account_type: {
                                  validators: {
                                    notEmpty: {
                                      message: 'Please select the account type'
                                    }
                                  }
                                },
                                email: {
                              validators: {
                                notEmpty: {
                                  message: 'Please supply your email address'
                                },
                                emailAddress: {
                                  message: 'Please supply a valid email address'
                                }
                              }
                            },
                            initial_deposit: {
                              validators: {
                                notEmpty: {
                                  message: 'The initial deposit must be greater than 500'
                                },
                                greaterThan: {
                                 value: 500,
                                 message: 'The initial deposit must be greater than 500'
                             }
                              }
                            }
                          }
                        })
         .on('success.form.bv', function(e) {
                              // Prevent submit form
                              e.preventDefault();
         
                              var $form     = $(e.target),
                              validator = $form.data('bootstrapValidator');
         
                              var json = {};
                              $("#new_account_details").serializeArray().map(function(item) {
                               json[item.name] = item.value;
                             });
                              console.log(json);
                              
                              //sending json to server
                              $.ajax({
                               type: "POST",
                               url: "http://localhost:8080/abcbank-rest/rest/service/addAccount",
                               data: JSON.stringify(json),
                               contentType: "application/json; charset=utf-8",
                               dataType: "json",
                               success: function(data){handleServerResponse(data)},
                               failure: function(errMsg) {
                                 alert("Failed");
                               }
                             });
         
         
         
         
                            });
         
         
         function handleServerResponse(response){
               console.log(response);
               if(response['status']=='SUCCESS'){
                       $('#success_message').slideDown({ opacity: "show" }, "slow");
         
               }else{
                       $('#failure_message').slideDown({ opacity: "show" }, "slow");
         
               }    
               $('message').text(response['message']);
         
             }
         
             $('#resetBtn').click(function() {
                 $('#new_account_details').data('bootstrapValidator').resetForm(true);
             });
         
         
         });
         
         
      </script>
   </body>
</html>